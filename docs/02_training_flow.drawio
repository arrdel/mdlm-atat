<mxfile host="65bd71144e">
    <diagram id="training-flow" name="Training Flow">
        <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1200" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                
                <!-- Title -->
                <mxCell id="title" value="ATAT Training Flow" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="500" y="20" width="400" height="40" as="geometry"/>
                </mxCell>
                
                <!-- Start -->
                <mxCell id="start" value="Start Training" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_1;whiteSpace=wrap;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="600" y="80" width="200" height="60" as="geometry"/>
                </mxCell>
                
                <!-- Data Loading -->
                <mxCell id="load-data" value="Load Dataset&#xa;(OpenWebText from scratch)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="600" y="180" width="200" height="60" as="geometry"/>
                </mxCell>
                
                <!-- Initialize Models -->
                <mxCell id="init-models" value="Initialize Models&#xa;- Base DiT&#xa;- Importance Estimator" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="600" y="280" width="200" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Epoch Start -->
                <mxCell id="epoch-start" value="For each training step" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="600" y="400" width="200" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Batch Processing -->
                <mxCell id="get-batch" value="Get Batch&#xa;(tokens, labels)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="600" y="520" width="200" height="60" as="geometry"/>
                </mxCell>
                
                <!-- Importance Estimation -->
                <mxCell id="estimate-importance" value="1. Estimate Token Importance&#xa;ImportanceEstimator(tokens, t)&#xa;→ importance scores [0,1]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="280" y="620" width="220" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Curriculum Stage -->
                <mxCell id="curriculum-stage" value="2. Get Curriculum Stage&#xa;CurriculumScheduler(step)&#xa;→ stage (easy/med/hard)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="540" y="620" width="220" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Adaptive Masking -->
                <mxCell id="adaptive-mask" value="3. Adaptive Masking&#xa;AdaptiveMasking(importance, stage)&#xa;→ mask probabilities" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="800" y="620" width="220" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Forward Diffusion -->
                <mxCell id="forward-diff" value="4. Forward Diffusion&#xa;Apply masks to tokens&#xa;Add noise at timestep t" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="280" y="740" width="220" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Model Forward -->
                <mxCell id="model-forward" value="5. Model Forward Pass&#xa;ATAT-DiT(noisy_tokens, t)&#xa;→ predictions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="540" y="740" width="220" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Compute Loss -->
                <mxCell id="compute-loss" value="6. Compute Loss&#xa;Cross-entropy + Importance loss&#xa;Weighted by curriculum" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="800" y="740" width="220" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Backward Pass -->
                <mxCell id="backward" value="7. Backward Pass&#xa;Compute gradients&#xa;Update weights" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="600" y="860" width="200" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Log Metrics -->
                <mxCell id="log-metrics" value="8. Log Metrics&#xa;Loss, perplexity, importance stats&#xa;→ WandB" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
                    <mxGeometry x="600" y="980" width="200" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Checkpoint Decision -->
                <mxCell id="checkpoint-check" value="Checkpoint&#xa;step?" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="880" y="980" width="120" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Save Checkpoint -->
                <mxCell id="save-checkpoint" value="Save Checkpoint&#xa;Model + Optimizer state" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
                    <mxGeometry x="1050" y="980" width="180" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Continue Training -->
                <mxCell id="continue-check" value="More&#xa;steps?" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="640" y="1100" width="120" height="80" as="geometry"/>
                </mxCell>
                
                <!-- End -->
                <mxCell id="end" value="Training Complete" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_1;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontSize=14;fontStyle=1" vertex="1" parent="1">
                    <mxGeometry x="400" y="1120" width="180" height="60" as="geometry"/>
                </mxCell>
                
                <!-- Arrows -->
                <mxCell id="a1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="start" target="load-data">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="load-data" target="init-models">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="init-models" target="epoch-start">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="epoch-start" target="get-batch">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="get-batch" target="estimate-importance">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="get-batch" target="curriculum-stage">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="get-batch" target="adaptive-mask">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="estimate-importance" target="forward-diff">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="curriculum-stage" target="model-forward">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="adaptive-mask" target="compute-loss">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="forward-diff" target="backward">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="model-forward" target="backward">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="compute-loss" target="backward">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="backward" target="log-metrics">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="log-metrics" target="checkpoint-check">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a15-label" value="Every step" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="a15">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <mxCell id="a16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="checkpoint-check" target="save-checkpoint">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a16-label" value="Yes" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="a16">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <mxCell id="a17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeWidth=2;" edge="1" parent="1" source="checkpoint-check" target="continue-check">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a17-label" value="No" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="a17">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <mxCell id="a18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeWidth=2;" edge="1" parent="1" source="save-checkpoint" target="continue-check">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;strokeWidth=2;" edge="1" parent="1" source="continue-check" target="epoch-start">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="200" y="1140"/>
                            <mxPoint x="200" y="440"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                
                <mxCell id="a19-label" value="Yes - Next Step" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontStyle=1" vertex="1" connectable="0" parent="a19">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint x="-30" y="-350" as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <mxCell id="a20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;strokeWidth=2;" edge="1" parent="1" source="continue-check" target="end">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="a20-label" value="No - Done" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="a20">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint x="10" as="offset"/>
                    </mxGeometry>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>
