<mxfile host="65bd71144e">
    <diagram id="importance-estimator" name="Importance Estimator Architecture">
        <mxGraphModel dx="1496" dy="731" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="2" value="Importance Estimator: Token Difficulty Prediction Network" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=22;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="200" y="20" width="1000" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="3" value="Input Layer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=14;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="40" y="80" width="1320" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="4" value="Token Embeddings&#xa;Shape: (B, L, D)&#xa;B = batch size&#xa;L = sequence length&#xa;D = embedding dim (768)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12" parent="1" vertex="1">
                    <mxGeometry x="60" y="160" width="280" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="5" value="Timestep t&#xa;Shape: (B,)&#xa;Float scalar&#xa;Range: [0, T]&#xa;T = max diffusion steps" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12" parent="1" vertex="1">
                    <mxGeometry x="380" y="160" width="280" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="Position IDs (optional)&#xa;Shape: (B, L)&#xa;Integer indices&#xa;Range: [0, L-1]&#xa;For position bias" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12" parent="1" vertex="1">
                    <mxGeometry x="700" y="160" width="280" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="7" value="Frequency Prior (optional)&#xa;Shape: (vocab_size,)&#xa;Pre-computed&#xa;Token frequencies&#xa;From training corpus" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12" parent="1" vertex="1">
                    <mxGeometry x="1020" y="160" width="280" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="8" value="Time Embedding Module" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top" parent="1" vertex="1">
                    <mxGeometry x="380" y="300" width="280" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="9" value="Sinusoidal Encoding&#xa;freq = 10000^(-2i/d)&#xa;PE_sin = sin(t * freq)&#xa;PE_cos = cos(t * freq)&#xa;Output: (B, 128)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" parent="1" vertex="1">
                    <mxGeometry x="400" y="340" width="240" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="10" value="MLP Projection&#xa;Linear(128 → 256)&#xa;SiLU activation&#xa;Linear(256 → 256)&#xa;Output: (B, 256)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" parent="1" vertex="1">
                    <mxGeometry x="400" y="420" width="240" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="Token Embedding Processing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top" parent="1" vertex="1">
                    <mxGeometry x="60" y="300" width="280" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="12" value="Layer Norm&#xa;normalize(x, dim=-1)&#xa;eps=1e-6" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" parent="1" vertex="1">
                    <mxGeometry x="80" y="340" width="240" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="13" value="Dropout (p=0.1)&#xa;During training only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" parent="1" vertex="1">
                    <mxGeometry x="80" y="400" width="240" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="14" value="Add Time Embedding&#xa;x = x + time_emb.unsqueeze(1)&#xa;Broadcasting: (B,L,256) + (B,1,256)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" parent="1" vertex="1">
                    <mxGeometry x="80" y="450" width="240" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="15" value="Transformer Layer 1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top" parent="1" vertex="1">
                    <mxGeometry x="40" y="540" width="640" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="16" value="Multi-Head Self-Attention&#xa;num_heads = 4&#xa;head_dim = 256 / 4 = 64&#xa;Q = Linear_q(x): (B,L,256)&#xa;K = Linear_k(x): (B,L,256)&#xa;V = Linear_v(x): (B,L,256)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left" parent="1" vertex="1">
                    <mxGeometry x="60" y="580" width="280" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="17" value="Attention Computation&#xa;scores = (Q @ K^T) / sqrt(64)&#xa;attn = softmax(scores, dim=-1)&#xa;attn = dropout(attn, p=0.1)&#xa;out = attn @ V&#xa;out = Linear_out(out)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;align=left" parent="1" vertex="1">
                    <mxGeometry x="360" y="580" width="300" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="18" value="Add &amp; Norm&#xa;x = x + dropout(attn_out)&#xa;x = LayerNorm(x)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="60" y="670" width="280" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="19" value="Feed-Forward Network&#xa;h = Linear(256 → 1024)&#xa;h = GELU(h)&#xa;h = dropout(h, p=0.1)&#xa;out = Linear(1024 → 256)&#xa;&#xa;Add &amp; Norm:&#xa;x = x + dropout(out)&#xa;x = LayerNorm(x)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;align=left" parent="1" vertex="1">
                    <mxGeometry x="360" y="670" width="300" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="20" value="Transformer Layer 2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top" parent="1" vertex="1">
                    <mxGeometry x="720" y="540" width="640" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="Multi-Head Self-Attention&#xa;(Same as Layer 1)&#xa;num_heads = 4&#xa;head_dim = 64&#xa;Independent parameters" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left" parent="1" vertex="1">
                    <mxGeometry x="740" y="580" width="280" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="22" value="Attention + Residual&#xa;(Same pattern as Layer 1)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="1040" y="580" width="300" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="Feed-Forward + Residual&#xa;(Same pattern as Layer 1)&#xa;1024 hidden units&#xa;GELU activation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10" parent="1" vertex="1">
                    <mxGeometry x="740" y="670" width="280" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="24" value="Output: (B, L, 256)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="1040" y="670" width="300" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="25" value="Importance Head" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top" parent="1" vertex="1">
                    <mxGeometry x="40" y="780" width="1320" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="26" value="Mean Pooling (Optional)&#xa;If global importance:&#xa;h = mean(x, dim=1)&#xa;Shape: (B, 256)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" parent="1" vertex="1">
                    <mxGeometry x="60" y="820" width="250" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="27" value="Projection Layer&#xa;Linear(256 → 1)&#xa;No bias&#xa;Xavier init&#xa;Shape: (B, L, 1) or (B, 1)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11" parent="1" vertex="1">
                    <mxGeometry x="340" y="820" width="250" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="28" value="Sigmoid Activation&#xa;importance = σ(logits)&#xa;Range: [0, 1]&#xa;0 = easy token&#xa;1 = hard token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="620" y="820" width="250" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="29" value="Frequency Prior Blending&#xa;If use_prior:&#xa;  importance = α*importance + (1-α)*freq_prior&#xa;  α = 0.7 (learned weight)&#xa;Combines learned + statistical" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11" parent="1" vertex="1">
                    <mxGeometry x="900" y="820" width="420" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="30" value="Final Output" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=14;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="400" y="960" width="600" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="31" value="Importance Scores&#xa;Shape: (B, L) - per-token scores&#xa;Range: [0, 1]&#xa;Interpretation:&#xa;  0.0-0.3: Easy (high-frequency, simple)&#xa;  0.3-0.7: Medium (moderate difficulty)&#xa;  0.7-1.0: Hard (low-frequency, complex)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;align=left" parent="1" vertex="1">
                    <mxGeometry x="450" y="1000" width="500" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="Model Parameters" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1;verticalAlign=top" parent="1" vertex="1">
                    <mxGeometry x="1370" y="190" width="260" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="33" value="Total: ~2M params&#xa;&#xa;Time Embedding:&#xa;  MLP: 128*256 + 256*256&#xa;  = 98,304 params&#xa;&#xa;Token Processing:&#xa;  LayerNorm: 512 params&#xa;&#xa;Transformer Layer 1:&#xa;  Q,K,V proj: 3*256*256&#xa;  Out proj: 256*256&#xa;  FFN: 256*1024 + 1024*256&#xa;  LayerNorms: 1024 params&#xa;  = 787,456 params&#xa;&#xa;Transformer Layer 2:&#xa;  (Same as Layer 1)&#xa;  = 787,456 params&#xa;&#xa;Importance Head:&#xa;  Linear: 256*1&#xa;  = 256 params&#xa;&#xa;Total: 1,673,984 ≈ 1.7M" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;fontSize=10;align=left" parent="1" vertex="1">
                    <mxGeometry x="1390" y="230" width="220" height="340" as="geometry"/>
                </mxCell>
                <mxCell id="34" value="Training Details" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12;fontStyle=1;verticalAlign=top" parent="1" vertex="1">
                    <mxGeometry x="40" y="1110" width="520" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="35" value="Loss Function:&#xa;  MSE between predicted and actual difficulty&#xa;  difficulty = fraction of models that get token wrong&#xa;&#xa;Optimizer: AdamW&#xa;  lr = 1e-4&#xa;  weight_decay = 0.01&#xa;  β1=0.9, β2=0.999&#xa;&#xa;Batch Size: 512 sequences&#xa;Sequence Length: 1024 tokens&#xa;Training Steps: Jointly with main model&#xa;Gradient Clipping: max_norm=1.0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;fontSize=10;align=left" parent="1" vertex="1">
                    <mxGeometry x="60" y="1150" width="480" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="36" value="Usage at Inference" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;verticalAlign=top" parent="1" vertex="1">
                    <mxGeometry x="600" y="1110" width="760" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="37" value="1. Forward pass with current tokens and timestep&#xa;   importance = model(token_emb, t)&#xa;&#xa;2. Use scores to weight masking probabilities&#xa;   mask_prob = adaptive_masking(importance, t)&#xa;&#xa;3. Higher importance → higher masking probability&#xa;   Focus training on difficult tokens&#xa;&#xa;4. Dynamic per-step:&#xa;   - Early training (t large): Focus on easy tokens&#xa;   - Late training (t small): Focus on hard tokens&#xa;&#xa;5. Curriculum integration:&#xa;   - Easy stage: mask importance &lt; 0.4&#xa;   - Medium stage: mask 0.3 &lt; importance &lt; 0.7&#xa;   - Hard stage: mask importance &gt; 0.6" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;fontSize=10;align=left" parent="1" vertex="1">
                    <mxGeometry x="620" y="1150" width="720" height="130" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>